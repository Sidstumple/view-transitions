@view-transition {
  navigation: auto;
}

:root {
  --ease: cubic-bezier(0.12, 0, 0.39, 0);
  --ease-out: cubic-bezier(0.61, 1, 0.88, 1);
}

@media (prefers-reduced-motion: no-preference) {
  [style*='--vt'] {
    view-transition-name: var(--vt);
  }

  .speaker-card,
  .speaker-header-image {
    view-transition-class: speaker-card;
  }

  .date {
    [style*='--vt'] {
      view-transition-class: code-prop-value;
    }
    [style*='--vt: code-semicolon'],
    [style*='--vt: code-colon'],
    [style*='--vt: code-open-bracket'] {
      view-transition-class: code-character;
    }
  }
}

html:active-view-transition-type(title-animation) {
  &::view-transition {
    pointer-events: none;
  }

  &:root,
  [style*='--vt'] {
    view-transition-name: none !important;
  }

}

html:active-view-transition-type(title-animation),
html:active-view-transition-type(speaker-to-overview) {

  .speakers .title,
  .speakers .talk-title {
    view-transition-class: text-animation;
  }

  &::view-transition-group(.text-animation) {
    mask-image: linear-gradient(to bottom, transparent, black 15%, black calc(100% - 15%), transparent);
    transform-style: preserve-3d;
  }

  &::view-transition-image-pair(.text-animation) {
    perspective: 1000px;
  }

  &::view-transition-old(.text-animation),
  &::view-transition-new(.text-animation) {
    animation-duration: 0.3s;
    animation-timing-function: var(--ease);
  }

  &::view-transition-new(.text-animation) {
    animation-name: out-in;
  }

  &::view-transition-old(.text-animation) {
    animation-name: in-out;
  }
}


@keyframes out-in {
  0% {
    translate: 0 100%;
    transform: rotateX(-90deg);
  }

  70% {
    transform: rotateX(0deg);
  }

  100% {
    translate: 0 0;
    transform: rotateX(0deg);
  }
}

@keyframes in-out {
  0% {
    translate: 0 0;
    transform: rotateX(0deg);
  }

  30% {
    transform: rotateX(0deg);
  }

  100% {
    translate: 0 -100%;
    transform: rotateX(90deg);
  }
}

html:active-view-transition-type(overview-to-speaker),
html:active-view-transition-type(speaker-to-overview) {
  &::view-transition-group(.speaker-card) {
    animation-duration: 0.6s;
    animation-timing-function: var(--ease);
    animation-fill-mode: both;
    overflow: hidden;
  }

  &::view-transition-old(.speaker-card),
  &::view-transition-new(.speaker-card) {
    animation: none;
    opacity: 1;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  &::view-transition-old(.speaker-card):only-child {
    animation-name: scale-out;
    animation-duration: 0.3s;
    animation-timing-function: var(--ease);
    animation-fill-mode: both;
    opacity: 1;
  }

  &::view-transition-new(.speaker-card):only-child {
    animation-name: scale-in;
    animation-duration: 0.3s;
    animation-delay: 0.35s;
    animation-timing-function: var(--ease);
    animation-fill-mode: both;
    opacity: 1;
  }
  
  
  &::view-transition-group(.code-prop-value) {
    animation-delay: calc(var(--delay) + 0.4s);
    animation-duration: 0s;
    animation-fill-mode: both;
  }
  
  &::view-transition-group(.code-character) {
    animation-delay: calc(var(--delay) + 0.4s);
    animation-duration: 0.05s;
    animation-fill-mode: both;
  }

  &::view-transition-group(code-class),
  &::view-transition-group(code-open-bracket) {
    --delay: 0.05s;
  }
  &::view-transition-group(code-property-1),
  &::view-transition-group(code-value-1),
  &::view-transition-group(code-colon-1),
  &::view-transition-group(code-semicolon-1) {
    --delay: 0.05s;
  }

  &::view-transition-group(code-property-2),
  &::view-transition-group(code-value-2),
  &::view-transition-group(code-colon-2),
  &::view-transition-group(code-semicolon-2) {
    --delay: 0.1s;
  }
  
  &::view-transition-group(code-property-3),
  &::view-transition-group(code-value-3),
  &::view-transition-group(code-colon-3),
  &::view-transition-group(code-semicolon-3) {
    --delay: 0.15s;
  }
  /* Thanks Jake! üôè https://jakearchibald.com/2024/view-transitions-handling-aspect-ratio-changes/ */
  &::view-transition-old(.code-prop-value),
  &::view-transition-new(.code-prop-value) {
    /* Break aspect ratio at an element level */
    height: 100%;
    /* But maintain it within the image itself */
    object-fit: none;
    /* And hide parts of the image that go out of bounds */
    overflow: clip;
    object-position: left;
    animation-duration: 0.4s;
    animation-timing-function: var(--ease);
  }
  
  &::view-transition-new(.code-prop-value) {
    animation-name: clip-to-right;
    animation-delay: calc(var(--delay) + 0.4s);
  }

  &::view-transition-old(.code-prop-value) {
    animation-name: clip-from-right;
    animation-delay: var(--delay);
  }
}

html:active-view-transition-type(overview-to-speaker) {
  &::view-transition-group(.speaker-card) {
    animation-duration: 0.6s;
    animation-delay: 0.1s;
  }

  &::view-transition-old(.speaker-card) {
    opacity: 0;
    animation: none;
  }
}

html:active-view-transition-type(speaker-to-overview) {
  --ease: var(--ease-out);
  
  &::view-transition-new(.speaker-card) {
    opacity: 0;
    animation: none;
  }
}


@keyframes scale-out {
  to {
    scale: 0;
    opacity: 0;
  }
}

@keyframes scale-in {
  from {
    scale: 0;
  }

  to {
    scale: 1;
    opacity: 1;
  }
}

@keyframes clip-to-right {
  from {
    clip-path: inset(0 100% 0 0);
  }
  to {
    clip-path: inset(0 0 0 0);
  }
}

@keyframes clip-from-right {
  from {
    clip-path: inset(0 0 0 0);
  }
  to {
    clip-path: inset(0 100% 0 0);
  }
}